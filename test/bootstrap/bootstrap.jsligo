#import "@ligo/fa/test/helpers/list.mligo" "List_helper"

#import "@ligo/fa/lib/fa2/asset/single_asset.impl.jsligo" "SingleAsset"

#import "../helpers/token.jsligo" "Token_helper"

#import "../helpers/dao.jsligo" "DAO_helper"

#import "../../src/main.jsligo" "DAO"

// Boostrapping of the test environment,
// initTokAmount is the amount of token allocated to every
// bootstrapped accounts

export const boot = (initTokAmount: nat, initStorage: DAO.storage) => {
    // Originate the token contract and the contract under test

    const tok = Token_helper.originate(initTokAmount);
    // Override governance token with test token

    const initDAOStorage = { ...initStorage, governanceToken: tok.addr };
    const dao = DAO_helper.originate(initDAOStorage);
    // Add the dao as operator for all the FA2 owner addresses
    //    TODO: ... in the real world, remove operator?

    Token_helper.
    add_operators(tok.owners, tok.taddr, dao.addr);
    // Set a token owner as sender in the Test framework

    const sender_ = List_helper.nth_exn(1)(tok.owners);
    Test.set_source(sender_);
    // Set the baker to 5th account

    const baker = Test.nth_bootstrap_account(5);
    Test.set_baker(baker);
    return [tok, dao, sender_];
};
